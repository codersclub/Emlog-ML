function TplShow(t){$(".option").hide(),$("."+t).fadeIn()}function block_drag_end(){$("form.tpl-options-form").trigger("submit")}$(function(){var t,e,o,n,i,a=window.tplOptions,s=$("body"),p=($('<iframe name="upload-image" src="about:blank" style="display:none"/>').appendTo(s),$("<div/>").insertAfter($("#content").find(".container-fluid .row")).addClass(v("area")).slideUp()),c=$("<div />").appendTo(s),l=($("<span />").appendTo($("#wrapper")),$("<span />").appendTo($("#wrapper")).attr({id:"goTopbtn",title:"返回顶部"}),$(".tpl")),r=$('<input type="file" name="image">').css({position:"absolute",margin:0,visibility:"hidden"}).on("change",function(){g(),o=t.data("target"),e.val(o),n.val(void 0),d.submit()}).on("mouseleave",function(){r.css("visibility","hidden"),t.css("visibility","visible")}),d=$('<form id="upload-form" target="upload-image" />').append(r,e=$('<input type="hidden" name="target">'),n=$('<input type="hidden" name="template">')).appendTo(s).attr({action:a.uploadUrl,target:"upload-image",enctype:"multipart/form-data",method:"post"});for(i of Object.keys(a.templates)){var u=document.querySelector("a[href*=\"em_confirm('"+i+"',\"]"),f=document.createElement("a");f.style.fontSize="12px",f.style.marginLeft="4px",u.parentNode.appendChild(f),$('<a class="btn btn-primary btn-sm">设置</span>').insertBefore(f).addClass(v("setting")).data("template",i)}s.on("click","."+v("setting"),function(){$(".container-fluid .row").fadeToggle(),$.ajax({url:a.baseUrl,data:{template:$(this).data("template")},cache:!1,beforeSend:function(){g(),editorMap={}},success:function(t){p.html(t).show(),l.hide(),window.setTimeout(function(){$(".option-sort-left").each(function(){$(this).find(".option-sort-name:first").addClass("selected")}),$(".option-sort-right").each(function(){$(this).find(".option-sort-option:first").addClass("selected")}),h(),setTimeout(function(){g(!1)},0)},1e3)}})}).on("click",".tpl-options-menu ul li,.tpl-nav-options ul li",function(){$(".tpl-options-menu ul li").removeClass("active"),$(".tpl-nav-options ul li").removeClass("active"),$(this).addClass("active")}).on("click",".tpl-options-close",function(){$(".container-fluid .row").fadeToggle(),p.slideUp(500),l.show()}).on("click","#goTopbtn",function(){$("body,html").animate({scrollTop:0},500)}).on("click",".option-name",function(){$(this).find(".option-description").fadeToggle(),$(this).parent().find(".option-body").fadeToggle(),$(this).parent().find(".option-ico").hasClass("upico")?$(this).parent().find(".option-ico").removeClass("upico").addClass("downico"):$(this).parent().find(".option-ico").removeClass("downico").addClass("upico")}).on("click",".tpl-options-menu li",function(){}).on("click",".vtpl-menu,.vtpl-nav.show ul li,.fixed-body",function(){$(".vtpl-nav").toggleClass("show")}).on("click",".tpl-options-menubtn",function(){$(".tpl-options-menu").fadeToggle()}).on("click",".tpl-options-btns",function(){1==$(this).attr("data-type")?($(this).text("全部展开").attr("data-type",0),$(".option-body").fadeOut(),$(".option-description").fadeOut(),$(".option-ico").removeClass("upico").addClass("downico")):($(this).text("全部收缩").attr("data-type",1),$(".option-body").fadeIn(),$(".option-description").fadeIn(),$(".option-ico").removeClass("downico").addClass("upico"))}).on("click",".option-sort-name",function(){var t,e,n=$(this);n.is(".selected")||(e=(t=n.parent()).siblings(".option-sort-right"),t.find(".selected").removeClass("selected"),n.addClass("selected"),e.find(".option-sort-option").removeClass("selected").eq(n.index()).addClass("selected"))}).on("change",".option-sort-select",function(){var t=$(this);t.parent().siblings(".option-sort-right").find(".option-sort-option").removeClass("selected").eq(t.find("option:selected").index()).addClass("selected")}).on("input propertychange paste change focus",".chosen-search-input",function(){_this_val=$(this).val().replace(/(^\s*)|(\s*$)/g,"");var t=$(this).attr("data-opt"),e=$(this).parent().parent().next();let n=$(this).parent().parent().next().find(".chosen-results");""===_this_val?(e.css("clip","rect(0, 0, 0, 0)"),e.css("clip-path","inset(100% 100%)"),e.css("position","absolute")):(e.css("clip","auto"),e.css("clip-path","none"),e.css("position","relative"),(e=new FormData).append("action","tpl_select_search"),e.append("kywd",$(this).val()),e.append("name",$(this).attr("data-s-name")),e.append("type",t),$.ajax({url:$(this).attr("data-url")+"content/plugins/tpl_options/actions/search.php",type:"post",data:e,cache:!1,processData:!1,contentType:!1,success:function(t){n.html(t)},error:function(t){n.html(t)}}))}).on("click",".chosen-results .active-result",function(){var t=$(this).html(),e=$(this).attr("data-s-name"),n=$(this).attr("data-id"),i=$(this).parent().parent().prev().find(".search-field"),o=$(this).parent().parent().prev().find(".search-field").find(".chosen-search-input"),a=$(this).parent().parent();i.before('<li class="search-choice"><span>'+t+'</span><a class="search-choice-close"><i class="icofont-close"></i></a><input class="d-none" name="'+e+'[]" type="text" value="'+n+'"></li>'),a.css("clip",""),a.css("clip-path",""),o.val(""),o.focus(),$("form.tpl-options-form").trigger("submit")}).on("click",".search-choice-close i",function(){$(this).parent().parent().remove(),$("form.tpl-options-form").trigger("submit")}).on("click",".tpl-block-title",function(){$(this).next().toggleClass("d-none"),$(this).find("span").toggleClass("icofont-rounded-right"),$(this).find("span").toggleClass("icofont-rounded-down")}).on("click",".tpl-add-block",function(){var t=$(this).attr("data-b-name"),e=$(this).attr("data-type"),n=$(this).attr("data-url");let i="";"image"===e?(i='<div class="tpl-block-upload"><span>填写块标题：</span><span class="image-tip">友情提示：选择文件后将会立刻上传覆盖原图</span><input class="block-title-input" type="text" name="'+t+'[title][]" value=""><div class="tpl-image-preview"><img src=""></div><div class="tpl-block-upload-input"><input type="text" name="'+t+'[content][]" value=""><label>\n<a class="btn btn-primary"><i class="icofont-plus"></i>上传</a>\n<input class="d-none tpl-image" type="file" name="image" data-url="'+n+'" accept="image/gif,image/jpeg,image/jpg,image/png">\n</label>',i+="</div></div>"):i=(i=i+'<span>填写块标题：</span><input class="block-title-input" type="text" name="'+t+'[title][]" value="">')+'<span>填写块内容：</span><textarea rows="8" name="'+t+'[content][]"></textarea>',$(this).before('<div class="tpl-block-item">\n    <div class="tpl-block-head">\n    <i class="tpl-block-clone icofont-ui-copy"></i>\n    <i class="tpl-block-remove icofont-close icofont-md"></i>\n    </div>\n    <h4 class="tpl-block-title">\n    <span class="tpl-block-title-icon icofont-rounded-right"></span>\n    <item class="block-title-text"></item>    </h4>\n    <div class="tpl-block-content d-none">\n'+i+"    </div>\n</div>"),$("form.tpl-options-form").trigger("submit")}).on("change",".tpl-image",function(){let e=this;var t=$(this).prop("files")[0],n=$(this).attr("data-url");let i=$(this).parent().parent().find('input[type="text"]'),o=$(this).parent().parent().prev().find("img");var a=new FormData;null!=t&&(a.append("action","tpl_upload"),a.append("image",t),a.append("origin_image",i.val()),$.ajax({url:n+"content/plugins/tpl_options/actions/tpl.php",type:"post",data:a,cache:!1,processData:!1,contentType:!1,success:function(t){t=JSON.parse(t);"success"===t.code?(i.val(t.data),o.attr("src",t.data+"?"+(new Date).getTime()),e.value="",$("form.tpl-options-form").trigger("submit")):cocoMessage.error(t.data,2500)},error:function(t){cocoMessage.error("网络异常",2500)}}))}).on("click",".tpl-block-remove",function(){confirm("真的要删除吗？")&&($(this).parent().parent().remove(),$("form.tpl-options-form").trigger("submit"))}).on("click",".tpl-block-clone",function(){var t=$(this).parent().parent().clone();$(this).parent().parent().after(t),$("form.tpl-options-form").trigger("submit")}).on("input change focus",".block-title-input",function(){let t=$(this).parent().prev().find("item");(t=$(this).parent().hasClass("tpl-block-upload")?$(this).parent().parent().prev().find("item"):t).html($(this).val())}).on("click",'.vtpl-switch-item input[type="checkbox"]',function(){$(this).is(":checked")?$(this).parent().parent().addClass("vtpl-checked"):$(this).parent().parent().removeClass("vtpl-checked")}).on("mouseenter",'.tpl-options-form input[type="file"]',function(){t=$(this),r.css(t.offset()),t.css("visibility","hidden"),r.css("visibility","visible")}).on("submit","form.tpl-options-form",function(){var t=$(this);return $.ajax({url:t.attr("action"),type:"post",data:t.serialize(),cache:!1,dataType:"json",success:function(t){if(1===t.code)return cocoMessage.error(t.msg,2500),!1;cocoMessage.success(t.msg,2500)},error:function(){cocoMessage.error("网络异常",2500)},complete:function(){}}),!1}).on("change",".tpl-options-form input:not(.chosen-search-input,.tpl-image), .tpl-options-form textarea",function(){$("form.tpl-options-form").trigger("submit")});m=0;var m,h=function(){$(".option-rich-text").each(function(){var t=$(this);void 0===t.attr("id")&&t.attr("id","option-rich-text-"+m++)}),window.setTimeout(function(){for(var t in editorMap)editorMap[t].container[0].style.width=""},100)};function g(t){(t=void 0===t?!0:t)?c.addClass("loading"):c.removeClass("loading")}function v(t){return a.prefix+t}window.setImage=function(t,e,n,i){0==n?($('[name="'+o+'"]').val(e).trigger("change"),$('[data-name="'+o+'"]').attr("href",t).find("img").attr("src",t)):alert("上传失败："+i),r.val(""),o="",g(!1)}}),$(window).scroll(function(){50<$(this).scrollTop()?$("#goTopbtn").fadeIn():$("#goTopbtn").fadeOut()});